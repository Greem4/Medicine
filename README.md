# Medicines

**Spring Medicines** – пет-проект на **Spring Boot** для управления списком лекарственных препаратов с поддержкой аутентификации/авторизации (через локальный логин/пароль и OAuth2 Яндекс), а также с отправкой email-уведомлений об истечении срока годности.
**Spring frontend** - приложение на react написанное для medicines

## Стек технологий

- **Язык**: Java 21+
- **Фреймворк**: Spring Boot 3.4.0 (Security, Data JPA, Mail)
- **База данных**: PostgreSQL
- **Миграции**: Liquibase
- **Аутентификация**:
    - Локальная (логин/пароль, `BCryptPasswordEncoder`)
    - OAuth2 (через Яндекс) с выдачей собственного JWT
- **Авторизация**: ролевой доступ (**USER**, **ADMIN**)
- **Токены**: JWT
- **Отправка email**: `JavaMailSender` + SMTP
- **Сборка**: Gradle, Docker
- **Тестирование**: JUnit, Testcontainers
- **Документация API**: Springdoc OpenAPI

## Функциональность

1. **Просмотр препаратов без авторизации**
    - `GET /api/medicines` — список лекарств
    - `GET /api/medicines/{id}` — детали препарата

2. **Аутентификация**
    - **Локальная**: `POST /api/auth/login` — выдаёт JWT
    - **OAuth2 через Яндекс**: при успехе возвращает локальный JWT

3. **Авторизация (роли)**
    - **USER** — просмотр списка и деталей препаратов
    - **ADMIN** — добавление, обновление, удаление препаратов, управление пользователями

4. **Email-уведомления**
    - Отправка писем об истечении срока годности препаратов
    - SMTP-настройки задаются в `application.yaml` или через `.env`
    - Используется `JavaMailSender`

5. **Liquibase**
    - Автоматическое создание таблиц и вставка тестовых данных при старте приложения

6. **Документация API**
      Порты по умолчанию закрыты.
    - Доступна по адресу: [http://localhost:8080/swagger-ui/index.html](http://localhost:8080/swagger-ui/index.html)

## Ключевые особенности

- **JWT**: При входе (локальный логин/пароль или OAuth2 Яндекс) приложение генерирует JWT, который клиент использует для доступа к API.
- **Яндекс OAuth2**: Успешный вход через Яндекс возвращает JWT, делая приложение stateless.
- **Ролевая авторизация**: Используются аннотации типа `hasRole('ADMIN')` для контроля доступа к защищенным ресурсам.
- **Подготовлена работа для работы на сервере с nginx HTTP -> HTTPS**

## Запуск и использование через Docker

Проект полностью упакован в Docker-контейнер

### Предварительные шаги

1. **Склонировать** репозиторий:
   ```bash
   git clone https://github.com/Greem4/Medicine.git
   cd Medicine
   git submodule update --init --recursive
2. **Подставить данные**
   .env (на основе .env.template)
3. **Запуск докера**
   ```bash
    docker compose --env-file .env up -d --build